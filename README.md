# LMArenaBridge Manager GUI 使用指南

`LMArenaBridge Manager` 是一个为 LMArenaBridge 项目量身打造的图形用户界面（GUI）工具，旨在简化项目的配置和管理流程。通过本工具，您可以轻松启动/停止服务、管理配置、更新模型，并监控系统状态，无需记忆和输入繁琐的命令行指令。

## 准备工作

### 安装 Python 依赖
打开终端，进入项目根目录，运行以下命令：
```bash
pip install -r requirements.txt
```

### 安装油猴脚本
1.  **安装油猴脚本管理器**: 为你的浏览器安装 Tampermonkey 或类似的脚本管理器扩展。
2.  **安装本项目油猴脚本**:
    *   打开 Tampermonkey 扩展的管理面板。
    *   点击“添加新脚本”或“Create a new script”。
    *   将 `TampermonkeyScript/LMArenaApiBridge.js` 文件中的所有代码复制并粘贴到编辑器中。
    *   保存脚本。

## 如何启动管理器

完成准备工作后，直接运行 `lmarena_manager.py` 脚本即可启动 GUI 应用程序：

```bash
python lmarena_manager.py
```

## 界面功能概览

应用程序主界面分为四个主要标签页，分别对应不同的管理功能。

---

### 1. 服务管理 (Service Management)

这是您与 LMArenaBridge 交互的主控制台。

  <!-- 占位符 -->

-   **API 服务器控制**:
    -   **状态显示**: 界面会实时显示 API 服务器的运行状态（运行中/已停止）。
    -   **启动/停止按钮**: 点击按钮可一键启动或停止后端的 API 服务。服务启动后，按钮状态会自动更新。

-   **服务日志**:
    -   **实时日志**: 这是一个滚动文本框，会实时捕获并显示来自 API 服务器的所有后台输出。当服务遇到问题时，这里的日志是排查错误的关键。
    -   **清空日志**: 清除日志显示区域的所有内容。
    -   **导出日志**: 将当前显示的日志内容保存到一个文本文件中，方便分享和分析。

---

### 2. 配置管理 (Configuration Management)

此页面允许您通过图形化界面修改核心配置文件 `config.jsonc` 的内容。

-   **API 密钥**:
    -   您可以手动输入您的 API 密钥。
    -   点击 **“生成随机密钥”** 按钮可以快速生成一个安全的32位随机密钥。

-   **会话管理**:
    -   **ID 显示**: 直观地展示当前配置的 `session_id` 和 `message_id`。
    -   **更新会话 ID**: 这是**最核心的功能之一**。
        1.  首先确保 API 服务器正在运行。
        2.  在下拉菜单中选择模式 (`direct_chat` 或 `battle`)。
        3.  点击 **“更新会话ID”** 按钮。
        4.  此时会弹出一个提示框，指导您在浏览器中打开的 LMArena 页面上点击任意一个“Retry”按钮。
        5.  操作完成后，程序会自动捕获新的 ID 并更新配置。

-   **操作按钮**:
    -   **保存配置**: 将您在界面上所做的所有修改保存到 `config.jsonc` 文件中。
    -   **重新加载配置**: 从 `config.jsonc` 文件中重新读取配置并刷新界面显示。
    -   **重置为默认值**: 将界面上的配置项恢复为默认设置（注意：此操作不会自动保存，需要手动点击“保存配置”）。

---

### 3. 模型管理 (Model Management)

用于管理 `models.json` 文件，该文件定义了您希望通过 API 使用哪些模型。

-   **模型列表**:
    -   以表格形式清晰地展示所有已配置模型的名称、类型（文本/图像）、模型 ID 和状态。

-   **操作**:
    -   **更新模型列表**: 向 API 服务器发送请求，触发浏览器端的油猴脚本自动抓取当前 LMArena 页面上所有可用的模型，并将其保存到 `available_models.json` 文件中。您可以参考这个文件来添加新模型。
    -   **添加新模型**: 弹出一个对话框，让您输入新模型的名称、ID 和类型，并将其添加到 `models.json` 中。
    -   **删除选中模型**: 从列表中选择一个模型并点击此按钮将其删除。

---

### 4. 状态监控 (Status Monitoring)

一个系统健康状况的仪表盘，帮助您快速诊断问题。

-   **连接状态**:
    -   实时显示 API 服务器、WebSocket 连接以及浏览器页面脚本的连接状态。

-   **快速测试**:
    -   **测试 API 连接**: 向 API 服务器发送一个请求，检查服务是否正常响应。
    -   **测试模型响应**: 使用您配置的第一个模型发送一个简单的测试请求，检查整个链路是否通畅。
    -   **诊断常见问题**: 一键自动检查多个常见的配置错误（如服务未运行、配置文件缺失、会话 ID 未设置等），并给出详细的报告和修复建议。

-   **系统信息**:
    -   显示当前运行环境的 Python 版本以及项目所需的依赖库是否都已正确安装。

---

通过本指南，您应该能够熟练使用 LMArenaBridge Manager 来管理您的服务。祝您使用愉快！
