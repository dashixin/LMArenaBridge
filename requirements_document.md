# LMArenaBridge 集成管理器需求文档

## 项目概述
设计并开发一个简单易用的GUI应用程序，集成LMArenaBridge项目的所有核心功能，替代当前需要运行多个独立脚本的复杂流程。

## 核心需求

### 1. 服务管理
- **启动/停止主API服务器** (api_server.py)
- **启动/停止文件床服务器** (file_bed_server/main.py)
- **实时显示服务状态** (运行中/已停止)
- **显示服务日志** (滚动显示最新日志信息)

### 2. 配置管理
- **查看和编辑基本配置** (config.jsonc)
  - API密钥设置
  - 功能开关 (绕过模式、酒馆模式、文件床等)
  - 超时设置
- **会话ID管理**
  - 显示当前会话ID和消息ID
  - 一键更新会话ID (集成id_updater.py功能)
  - 选择模式 (DirectChat/Battle)

### 3. 模型管理
- **查看当前可用模型** (models.json)
- **更新模型列表** (集成model_updater.py功能)
- **添加/删除模型** (可视化编辑models.json)
- **模型会话映射管理** (model_endpoint_map.json)

### 4. 连接状态监控
- **WebSocket连接状态** (油猴脚本连接状态)
- **浏览器页面状态** (是否打开LMArena页面)
- **API测试功能** (快速测试API是否正常工作)

### 5. 快速操作
- **一键启动所有服务**
- **一键配置向导** (首次使用引导)
- **快速故障诊断** (检查常见问题)

## 技术规格

### 界面框架
- **技术选择**: Tkinter (Python内置，无需额外依赖)
- **界面风格**: 简洁实用，分标签页组织功能
- **响应式**: 支持窗口大小调整

### 架构设计
- **主程序**: `lmarena_manager.py`
- **配置模块**: 统一的配置文件读写
- **服务模块**: 子进程管理和监控
- **日志模块**: 统一的日志显示和管理

## 界面设计

### 主窗口布局
```
┌─────────────────────────────────────────────────────┐
│ LMArenaBridge 管理器                                │
├─────────────────────────────────────────────────────┤
│ [服务管理] [配置管理] [模型管理] [状态监控] [帮助]    │
├─────────────────────────────────────────────────────┤
│                                                     │
│              标签页内容区域                          │
│                                                     │
├─────────────────────────────────────────────────────┤
│ 状态栏: API服务器: ●运行中 | 文件床: ○已停止        │
└─────────────────────────────────────────────────────┘
```

### 标签页详细设计

#### 1. 服务管理标签
```
┌─────────────────────────────────────────────────────┐
│ 服务控制                                            │
│ ┌─────────────────┐ ┌─────────────────┐             │
│ │ [启动API服务器]  │ │ [启动文件床服务] │             │
│ │ [停止API服务器]  │ │ [停止文件床服务] │             │
│ └─────────────────┘ └─────────────────┘             │
│                                                     │
│ 服务日志                                            │
│ ┌─────────────────────────────────────────────────┐ │
│ │ [2024-01-01 10:00:00] API服务器启动成功...      │ │
│ │ [2024-01-01 10:00:01] WebSocket连接建立...      │ │
│ │ [2024-01-01 10:00:02] 收到API请求...            │ │
│ └─────────────────────────────────────────────────┘ │
│ [清空日志] [导出日志]                               │
└─────────────────────────────────────────────────────┘
```

#### 2. 配置管理标签
```
┌─────────────────────────────────────────────────────┐
│ 基本配置                                            │
│ API密钥: [123456                    ] [生成随机密钥] │
│ □ 启用绕过模式  □ 启用酒馆模式  □ 启用文件床        │
│                                                     │
│ 会话管理                                            │
│ 当前会话ID: d3d4435c-e620-4dad-857d-51c263f8f8f8    │
│ 当前消息ID: e6fc6421-d8b9-42a1-82b2-55fb0e3e703b    │
│ 模式: [DirectChat ▼] [更新会话ID]                   │
│                                                     │
│ [保存配置] [重置为默认值]                           │
└─────────────────────────────────────────────────────┘
```

#### 3. 模型管理标签
```
┌─────────────────────────────────────────────────────┐
│ 可用模型列表                        [更新模型列表]  │
│ ┌─────────────────────────────────────────────────┐ │
│ │ ☑ gemini-2.5-pro     (文本模型)                │ │
│ │ ☑ gpt-5              (文本模型)                │ │
│ │ ☑ nano-banana        (图像模型)                │ │
│ │ ☐ claude-3-opus      (文本模型) [添加]         │ │
│ └─────────────────────────────────────────────────┘ │
│                                                     │
│ 模型操作                                            │
│ [添加新模型] [删除选中模型] [编辑模型映射]          │
│                                                     │
│ 高级会话映射                                        │
│ [配置模型专属会话] [导入/导出配置]                  │
└─────────────────────────────────────────────────────┘
```

#### 4. 状态监控标签
```
┌─────────────────────────────────────────────────────┐
│ 连接状态                                            │
│ API服务器:     ● 运行中 (端口5102)                  │
│ 文件床服务:    ○ 已停止                            │
│ WebSocket:     ● 已连接                             │
│ 浏览器页面:    ● LMArena页面已打开                  │
│                                                     │
│ 快速测试                                            │
│ [测试API连接] [测试模型响应] [诊断常见问题]         │
│                                                     │
│ 系统信息                                            │
│ Python版本: 3.9.0                                   │
│ 依赖状态: ✓ 所有依赖已安装                          │
│ 配置状态: ✓ 配置文件完整                            │
└─────────────────────────────────────────────────────┘
```

#### 5. 帮助标签
```
┌─────────────────────────────────────────────────────┐
│ 快速开始                                            │
│ [首次使用向导] [常见问题解答] [查看完整文档]        │
│                                                     │
│ 关于                                                │
│ LMArenaBridge 管理器 v1.0                           │
│ 基于 LMArenaBridge v2.7.6                           │
│ [检查更新] [访问GitHub] [报告问题]                  │
└─────────────────────────────────────────────────────┘
```

## 开发计划

### 阶段1: 基础框架 ✅
- [x] 创建需求文档
- [x] 搭建Tkinter主窗口框架
- [x] 实现标签页布局
- [x] 创建基础UI组件

### 阶段2: 服务管理 ✅
- [x] 实现服务启动/停止功能
- [x] 集成日志显示
- [x] 添加服务状态监控

### 阶段3: 配置管理 ✅
- [x] 实现配置文件读写
- [x] 集成会话ID更新功能
- [x] 添加配置验证

### 阶段4: 模型管理 ✅
- [x] 实现模型列表显示
- [x] 集成模型更新功能
- [x] 添加模型编辑功能

### 阶段5: 状态监控 ✅
- [x] 实现连接状态检测
- [x] 添加API测试功能
- [x] 实现故障诊断

### 阶段6: 完善优化 ✅
- [x] 添加首次使用向导
- [x] 完善错误处理
- [x] 优化用户体验

## 成功标准
1. 用户可以通过GUI完成所有原本需要命令行的操作
2. 界面直观易用，无需查看文档即可上手
3. 集成度高，减少用户需要记忆的操作步骤
4. 稳定可靠，能够正确处理各种异常情况

## 更新日志
- 2025-09-19: 创建初始需求文档
- 2025-09-19: 完成所有开发阶段，LMArenaBridge集成管理器开发完成

## 项目完成总结

### 已实现的核心功能
1. **完整的GUI界面**: 基于Tkinter的现代化标签页界面
2. **服务管理**: 一键启动/停止API服务器和文件床服务器
3. **实时日志监控**: 集成的日志显示和导出功能
4. **配置管理**: 可视化编辑config.jsonc，支持所有配置选项
5. **会话ID管理**: 集成id_updater.py功能，一键更新会话ID
6. **模型管理**: 可视化管理models.json，集成model_updater.py功能
7. **状态监控**: 实时显示服务状态，API测试，故障诊断
8. **首次使用向导**: 6步向导引导用户完成初始配置
9. **错误处理**: 完善的异常处理和用户友好的错误提示

### 技术特点
- **零额外依赖**: 仅使用Python标准库，无需安装额外GUI框架
- **进程管理**: 安全的子进程启动和监控
- **配置保留**: 智能的JSONC配置文件编辑，保留注释和格式
- **线程安全**: 正确的GUI线程和后台线程交互
- **用户体验**: 直观的界面设计和操作流程

### 使用方法
```bash
python lmarena_manager.py
```

用户现在可以通过这个单一的GUI应用程序完成所有LMArenaBridge的配置和管理任务，无需记忆复杂的命令行操作。
